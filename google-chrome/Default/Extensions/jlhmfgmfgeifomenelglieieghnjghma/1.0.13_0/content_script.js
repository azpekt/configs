var ContentScript=function(t){return t.id=chrome.runtime.id,t.port=null,t.token_="",t.whiteList=[],t.hashList=[],t.uuid_="",t.initHashList=function(){t.hashList.push("X4WKTojPTBCkUep3mJ4lISkJd5xjgCy7t3WOV9ekcYQ="),t.hashList.push("64tUupzAFkz0sO9FdxdKzXPU1M+kX5addpE8cY8KwMY="),t.hashList.push("Y1UGgNTP1Q1s+ApMq8hsYXhEOhDHsCr5/q5bbvBFP/c="),t.hashList.push("eaShT5BXYGibkON42a7ewRxsy4+PSGtTMh2fG54Zf7A="),t.hashList.push("bzT9bgmTETuVqCgVxPDSjrnTqC6N14zH8kVD/pHJBdw="),t.hashList.push("Y1KRUKo4HpiaxizSb9jeqQR7pL82VYHg0CMQHD0EHHI="),t.hashList.push("1bIZVrqEKHJbytsxxLWDyOXWT4CQO7K46V4lOryJIJo=")},t.initWhiteList=function(){t.whiteList.push("atmccli.dll"),t.whiteList.push("ateccli.dll"),t.whiteList.push("wbxtccli.dll"),t.whiteList.push("wbxmgrtc.dll"),t.whiteList.push("wbxtcholcli.dll"),t.whiteList.push("tcholmgr.dll"),t.whiteList.push("atsc3cls.dll"),t.whiteList.push("atsccli.dll"),t.whiteList.push("atsccust.dll"),t.whiteList.push("ataactrl.dll"),t.whiteList.push("aasetup.dll"),t.whiteList.push("raagt.dll"),t.whiteList.push("atstctrl.dll"),t.whiteList.push("atplycli.dll"),t.whiteList.push("atrcp.dll"),t.whiteList.push("atshcli.dll"),t.whiteList.push("atconfui.bundle"),t.whiteList.push("wbxmgrmc.bundle"),t.whiteList.push("wbxmgrtc.bundle"),t.whiteList.push("wbxmgrec.bundle"),t.whiteList.push("tcholmgr.bundle"),t.whiteList.push("asplayback.bundle"),t.whiteList.push("nbrpfw.bundle"),t.whiteList.push("raconfui.bundle"),t.whiteList.push("pcnow client.app"),t.whiteList.push("pcnow process manager.app")},t.uuid=function(){var t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:7&n|8).toString(16)})},t.filterLog=function(t){var e={};for(var n in t){var i=t[n];if(n.match(/location\d+_url|szhomepage\d+/i))try{var s=document.createElement("a");if(s.href=atob(i),s.hostname.trim().toLowerCase().match(/webex\.com$|webex\.com\.cn$|^_self$/i))continue}catch(t){}else if("clientparam_value"===n.trim().toLowerCase()){var o=(new DOMParser).parseFromString(atob(i),"text/xml");if(o&&"root"===o.childNodes[0].nodeName)continue}else if(i.match(/^\d+$|^\d+\.\d+$/))continue;e[n]=i}return e},t.sendLog=function(e){if(navigator.platform.match(/win/i))try{var n="string"==typeof e.message?JSON.parse(e.message):e.message;"launch_meeting"===e.message_type&&(n=t.filterLog(n)),n.ext_tracking_id=t.uuid_,chrome.runtime.sendMessage(n,function(t){})}catch(t){chrome.runtime.sendMessage(e.message,function(t){})}},t.verifyScriptCall=function(e){var n=/^(WebEx_|As[ADEPS]|RA[AM])|^(Ex|In)it|^(FinishC|Is[NS]|JoinM|[NM][BCS][JRUC]|Set|Name|Noti|Trans|Update)|^(td|SCSP)$/;if(e.length>10240)return!1;for(var i=e.split(";"),s=0;s<i.length;s++){var o=i[s].trim(),a="",r=o.indexOf("=");if(r>=0){if("szCookie"!=o.substring(0,r).trim())return!1;o=o.substring(r+1).trim()}(r=o.indexOf("("))>=0&&(a=o.substring(r+1),o=o.substring(0,r).trim());var c=a.split(",");if(a.length>1024||c.length>20)return!1;if(o.length>0&&!o.match(n))return!1;if(o.match(/2$/))return!1;for(var l=t.crypto(o),h=0;h<t.hashList.length;h++)if(l==t.hashList[h])return!1}return!0},t.verify=function(e){if("connect"!=e.message_type&&"disconnect"!=e.message_type&&"launch_meeting"!=e.message_type)return!1;if("launch_meeting"==e.message_type){try{if("string"!=typeof e.message)return!1;if(e.message.includes("\\u0000"))return!1;var n=JSON.parse(e.message);if(navigator.platform.match(/win/i)){if("Win",(a=n.GpcExtName)&&"atgpcext"!=(a=a.trim()).toLowerCase()&&"atgpcext"!=atob(a).toLowerCase().trim())return!1;var i=n.GpcUnpackName;if(i&&"atgpcdec"!=(i=i.trim()).toLowerCase()&&"atgpcdec"!=atob(i).toLowerCase().trim())return!1;var s=n.GpcInitCall;if(s&&!t.verifyScriptCall(atob(s.trim())))return!1;var o=n.GpcExitCall;if(o&&!t.verifyScriptCall(atob(o.trim())))return!1}else{if(!navigator.platform.match(/mac/i))return!1;"Mac";var a=n.GpcExtName.trim();if("atgpcext64"!=a.toLowerCase()&&"atgpcext64"!=atob(a).toLowerCase().trim())return!1}var r=n.GpcComponentName.toLowerCase().trim();null==r.match(/\.dll$|\.bundle$|\.app$/)&&(r=(r=atob(n.GpcComponentName)).toLowerCase().trim());var c=0;for(c=0;c<t.whiteList.length;c++)if(r==t.whiteList[c])return!0}catch(t){}return!1}return!0},t.handleStateChanged=function(e){console.info("[ContentScript] handleStateChanged: result=",e);var n={timestamp:(new Date).toUTCString(),token:t.token_,message_type:"state_changed",message:{ExtState:{result:e,reason:e?"ok":"ExtensionNotInstalled"},HostState:{result:!1,reason:"HostNotInstalled"}}};t.handleNativeMessage(n)},t.handleNativeMessage=function(e){console.info("[ContentScript] handleNativeMessage: message=",e),"launch_meeting_ack"===e.message_type&&t.sendLog(e);var n=new CustomEvent("native_message",{detail:e});window.parent.document.dispatchEvent(n)},t.handleNativeDisconnect=function(e){console.info("[ContentScript] port.onDisconnect: self.port=",t.port);var n={timestamp:(new Date).toUTCString(),token:t.token_,message_type:"disconnect",message:"disconnect"};t.port=null,t.handleNativeMessage(n)},t.sendMessage=function(e,n){console.info("[ContentScript] sendMessage: self.port=",t.port),console.info("[ContentScript] sendMessage: message=",e);try{if(!t.verify(e)){s={timestamp:(new Date).toUTCString(),token:t.token_,message_type:"error",message:{error_code:1005,error_message:"BadDocShow"}};if(t.handleNativeMessage(s),null!=t.port){var i={timestamp:(new Date).toUTCString(),token:t.token_,message_type:"disconnect",message:"disconnect"};t.port.postMessage(i)}return}"launch_meeting"===e.message_type&&(e.domain=window.location.protocol+"//"+window.location.host),null!=t.port&&t.port.postMessage(e),"launch_meeting"===e.message_type&&t.sendLog(e)}catch(e){var s={timestamp:(new Date).toUTCString(),token:t.token_,message_type:"error",message:{error_code:-1,error_message:e.toString()}};t.handleNativeMessage(s)}},t.connectPort=function(e){var n=window.location.host;if(console.info("[ContentScript] connectPort: extId=",e,"self.port=",t.port,"host=",n),!t.port)try{t.port=chrome.runtime.connect(e,{name:t.token_}),console.info("[ContentScript] connectPort: self.port=",t.port,"now=",performance.now()),null!=t.port&&(t.port.onMessage.addListener(t.handleNativeMessage),t.port.onDisconnect.addListener(t.handleNativeDisconnect))}catch(t){console.info("[ContentScript] connectPort: err=",t),ContentScript.handleStateChanged(!1)}},t.crypto=function(t){return CryptoJS.SHA256(t).toString(CryptoJS.enc.Base64)},t.init=function(){console.info("[ContentScript] init: chrome.runtime.id=",chrome.runtime.id),t.initWhiteList(),t.initHashList(),t.uuid_=t.uuid(),document.addEventListener("connect",function(e){console.info("[ContentScript] connect: e=",e),t.token_=e.detail.token,t.connectPort(chrome.runtime.id)}),document.addEventListener("message",function(e){console.info("[ContentScript] message: e=",e),t.sendMessage(e.detail,t.handleNativeMessage)})},t}(ContentScript||{});ContentScript.init(),window.onload=function(){ContentScript.handleStateChanged(!0)};